<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.oasis.spiderman.dao.form.FormBaseDAO">
	
	<resultMap type="com.oasis.spiderman.common.vo.approvalForm.FormBaseVO" id="FormBaseMap">
	<result property="processId" column="process_id"/>
	<result property="proDefiCode" column="pro_defi_code"/>
	<result property="branchCode" column="branch_code"/>
	<result property="branchName" column="branch_name"/>
	<result property="orgId" column="org_id"/>
	<result property="incStatus" column="p_inc_status"/>
	<result property="domainId" column="domain_id"/>
	<result property="creatorId" column="CREATOR_ID"/>
	<result property="updatorId" column="UPDATOR_ID"/>
	</resultMap> 

	<insert id="insert" parameterType="FormBase">
		<selectKey keyProperty="id" resultType="long" order="BEFORE">
			select WL_FORM_SEQUENCE.nextval from dual
        </selectKey>

		INSERT INTO WL_FORM_BASE 
		(
			id, 
			process_id, 
			branch_code,
			branch_name,
			org_id,
			p_inc_status,
			pro_defi_code,
			created_time, 
			updated_time, 
			creator_id, 
			updator_id
		)
        VALUES
        (
	        #{id:NUMERIC},
	        #{processId:NUMERIC},
	        #{branchCode:VARCHAR},
	        #{branchName:VARCHAR},
	        #{orgId:VARCHAR},
	        #{incStatus:VARCHAR},
	        #{proDefiCode:VARCHAR},
	        #{createdTime:TIMESTAMP},
	        #{updatedTime:TIMESTAMP},
	        #{creatorId:NUMERIC},
	        #{updatorId:NUMERIC}
        )
	</insert>
	
	<update id="update" parameterType="FormBase">
		UPDATE WL_FORM_BASE pd
        SET 
	        pd.updated_time=#{updatedTime:TIMESTAMP}, 
	        pd.updator_id=#{updatorId:NUMERIC}, 
	        pd.p_inc_status=#{incStatus:VARCHAR},
	        pd.org_id=#{orgId:VARCHAR},
	        pd.branch_name=#{branchName:VARCHAR}
	    WHERE
	    	pd.id=#{id:NUMERIC}
	</update>
	
	<delete id="deleteByProIncId" parameterType="long">
		DELETE WL_FORM_BASE fb
		WHERE fb.process_id = #{id:NUMERIC}
	</delete>
	
	<delete id="delete">
		<include refid="sqlmap.common.model.delete" />
	</delete>
	
	<select id="find" parameterType="long" resultType="FormBase">
		SELECT t.* FROM WL_FORM_BASE t
		WHERE t.id = #{id:NUMERIC}
	</select>
	
	<select id="findByProIncId" parameterType="long" resultType="FormBase">
		SELECT t.* FROM WL_FORM_BASE t
		WHERE t.process_id = #{id:NUMERIC}
	</select>
	
	<select id="selectPageList" resultMap="FormBaseMap" parameterType="FormBaseSO">
		select  t.*  from WL_FORM_BASE t where 1=1
		AND t.creator_id = #{operatorId:NUMERIC} 
		<include refid="pageListClause"/>
	</select>
	
	<select id="selectCount" resultType="int" parameterType="FormBaseSO">
		select count(t.id)  from WL_FORM_BASE t where 1=1
		<include refid="pageListClause"/>
	</select>
	
	<sql id="pageListClause">
		<if test="processId!=null and processId!='' ">
		and t.process_id = #{processId}
		</if>
		<if test="proDefiCode!=null and proDefiCode!='' ">
		and t.pro_Defi_Code like '%'||#{proDefiCode}||'%'
		</if>
		<if test="branchCode!=null and branchCode!='' ">
		and t.branch_Code like '%'||#{branchCode}||'%'
		</if>
		<if test="branchName!=null and branchName!='' ">
		and t.branch_Name like '%'||#{branchName}||'%'
        </if>
        <if test="orgId!=null and orgId!='' ">
        and t.org_Id = #{orgId}
        </if>
        <if test="createTimeStart!=null">
		<![CDATA[AND t.created_time >= #{createTimeStart}]]>
		</if>
		<if test="createTimeEnd!=null">
		<![CDATA[AND t.created_time <= #{createTimeEnd}]]>
		</if>
	</sql>
</mapper>