<?xml version="1.0" encoding="UTF-8"?>

<hsdoc version="1.1.0">
  <Windows>
    <control-MainWindow height="468" name="MainWin" templatePath="window.ftl" width="1103">
      <layout-fit>
        <control-Panel height="200" name="Panel1" width="300">
          <layout-border>
            <control-Panel region="center" border="false" height="200" name="Panel2" width="300">
              <layout-border>
                <control-Grid hasCheckColumn="true" region="center" remoteSort="true" enableCellTip="true" width="300" height="169" dataSet="DataSet1" name="Grid1" hasCustomPageSize="true" border="false" hasPagingBar="true">
                  <layout-GridToolbar>
                    <control-GridItem title="客户名称" align="left" dataIndex="nick" name="GridItem2" width="243"/>
                    <control-GridItem title="客户性质" align="left" dataIndex="name" name="GridItem9" width="138" sortable="true"/>
                    <control-GridItem align="center" width="116" title="客户等级" dataIndex="age" sortable="true" name="GridItem5"/>
                    <control-GridItem title="电话" align="center" dataIndex="sex" name="GridItem8" width="121"/>
                    <control-GridItem title="电子邮件" align="left" name="GridItem1" sortable="true" width="162"/>
                    <control-GridItem title="联系人" align="left" name="GridItem3" sortable="true" width="100"/>
                    <control-GridItem title="联系记录" align="left" name="GridItem4" sortable="true" width="100"/>
                  </layout-GridToolbar>
                </control-Grid>
                <control-FormPanel collapseMode="mini" region="north" width="300" height="178" hideCollapseTool="true" collapsible="true" split="true" name="FormPanel1" border="false" submitService="bizframe.authority.user.queryUser">
                  <Top>
                    <control-Toolbar name="Toolbar9">
                      <layout-toolbar>
                        <control-Button name="addUser_btn" text="新增" width="75" icon="bizframe/images/icons/add.gif" tabIndex="10"/>
                        <control-Button name="editUser_btn" text="修改" width="75" icon="bizframe/images/icons/edit.png" tabIndex="11"/>
                        <control-Button name="delUser_btn" text="删除" width="75" icon="bizframe/images/icons/delete.gif" tabIndex="12"/>
                        <control-Button name="Button1" text="信息查看" width="75" icon="bizframe/images/icons/user.gif" tabIndex="18"/>
                      </layout-toolbar>
                    </control-Toolbar>
                  </Top>
                  <Bottom>
                    <control-ButtonGroup name="ButtonGroup3">
                      <layout-buttonGroup>
                        <control-Button name="queryUser_btn" text="查询" width="75" icon="bizframe/images/icons/search.png" tabIndex="2"/>
                        <control-Button tipText="清空查询条件" name="Button22" text="重置" width="75" icon="bizframe/images/icons/refresh.png" tabIndex="3"/>
                      </layout-buttonGroup>
                    </control-ButtonGroup>
                  </Bottom>
                  <Left/>
                  <Right/>
                  <layout-table columns="3" fullWidth="true">
                    <control-TextField labelAlign="right" msgTarget="qtip" labelWidth="80" fieldName="userId" width="22%" height="22" fieldLabel="客户编码" name="TextField2" tabIndex="4"/>
                    <control-TextField labelAlign="right" msgTarget="qtip" labelWidth="80" fieldName="userName" width="22%" height="22" fieldLabel="客户名称" name="TextField1" tabIndex="5"/>
                    <control-HiddenField fieldName="orgId" name="searchOrgId"/>
                    <control-TextField labelAlign="right" labelWidth="80" width="22%" height="22" fieldLabel="拼音码" name="TextField3" tabIndex="86"/>
                    <control-NumberField labelAlign="right" labelWidth="80" width="22%" height="22" fieldLabel="电话" name="NumberField1" tabIndex="87"/>
                    <control-ComboBox labelAlign="right" labelWidth="80" width="22%" height="22" fieldLabel="所属人部门" name="ComboBox1" tabIndex="88"/>
                    <control-ComboBox labelAlign="right" labelWidth="80" width="22%" height="22" fieldLabel="所属人" name="ComboBox2" tabIndex="89"/>
                    <control-ComboBox labelAlign="right" labelWidth="80" width="22%" height="22" fieldLabel="客户等级" name="ComboBox3" tabIndex="90"/>
                    <control-ComboBox labelAlign="right" labelWidth="80" width="22%" height="22" fieldLabel="客户来源" name="ComboBox4" tabIndex="91"/>
                    <control-ComboBox labelAlign="right" labelWidth="80" width="22%" height="22" fieldLabel="客户性质" name="ComboBox5" tabIndex="92"/>
                  </layout-table>
                </control-FormPanel>
              </layout-border>
              <Top/>
              <Bottom/>
              <Left/>
              <Right/>
            </control-Panel>
          </layout-border>
          <Top/>
        </control-Panel>
      </layout-fit>
    </control-MainWindow>
    <control-Window width="790" height="397" title="新增客户" maximized="true" name="Window1" resizable="false" draggable="true">
      <layout-fit>
        <control-FormPanel border="false" height="200" frame="true" submitService="bizframe.authority.user.insertUser" name="FormPanel2" width="300">
          <layout-table columns="2" fullWidth="true">
            <control-TextField labelAlign="right" msgTarget="qtip" suffixLabel="&lt;span style=&quot;color:red;&quot;&gt;*&lt;/span&gt;" regexText="非法输入，只能输入英文、数字和下划线" fieldName="userId" width="370" height="22" regex="/^[\w\u4e00-\u9fa5\.\/\,\，\.\。\“\（\）\(\)\-\s]*$/" minLength="1" fieldLabel="用户名" maxLength="32" name="name" allowBlank="false" tabIndex="73"/>
            <control-TextField labelAlign="right" msgTarget="qtip" suffixLabel="&lt;span style=&quot;color:red;&quot;&gt;*&lt;/span&gt;" regexText="非法输入，只能输入中文、英文、数字和下划线" fieldName="userName" width="370" height="22" regex="/^[\w\u4e00-\u9fa5\.\/\,\，\.\。\“\（\）\(\)\-\s]*$/" minLength="1" fieldLabel="用户昵称" maxLength="32" name="UIUserName" allowBlank="false" tabIndex="75"/>
            <control-NumberField defaultValue="999" dataField="userOrder" labelAlign="right" fieldName="age" width="370" height="22" fieldLabel="年龄" name="UIUserOrder" allowBlank="false"/>
            <control-HiddenField fieldName="orgId" name="addOrgId"/>
            <control-TextField fieldLabel="性别" height="22" labelAlign="right" name="sex" width="370" tabIndex="84"/>
          </layout-table>
        </control-FormPanel>
      </layout-fit>
      <Bottom>
        <control-ButtonGroup name="Toolbar2">
          <layout-buttonGroup>
            <control-Button name="Button8" text="继续添加" width="75" icon="bizframe/images/icons/add2.png" tabIndex="80"/>
            <control-Button name="Button5" text="确定" width="75" icon="bizframe/images/icons/accept.png" tabIndex="81"/>
            <control-Button name="Button7" text="重置" width="75" icon="bizframe/images/icons/refresh.png" tabIndex="82"/>
            <control-Button name="Button6" text="取消" width="75" icon="bizframe/images/icons/cross.gif" tabIndex="83"/>
          </layout-buttonGroup>
        </control-ButtonGroup>
      </Bottom>
    </control-Window>
    <control-Window width="790" height="300" title="修改客户" maximized="true" name="Window2" resizable="false" draggable="true">
      <layout-fit>
        <control-FormPanel submitServiceAlias="bizSetUser$bizUserModfiy" autoload="false" width="300" height="200" dataSet="DataSet3" name="FormPanel3" frame="true">
          <layout-table columns="2" fullWidth="true">
            <control-TextField dataField="name" labelAlign="right" msgTarget="qtip" editable="false" fieldName="userId" width="370" height="22" minLength="1" fieldLabel="用户名" maxLength="32" name="UIUserId" allowBlank="false" tabIndex="63"/>
            <control-TextField dataField="nick" labelAlign="right" msgTarget="qtip" suffixLabel="&lt;span style=&quot;color:red;&quot;&gt;*&lt;/span&gt;" regexText="非法输入，只能输入中文、英文、数字和下划线" fieldName="userName" width="370" height="22" regex="/^[\w\u4e00-\u9fa5\.\/\,\，\.\。\“\（\）\(\)\-\s]*$/" minLength="1" fieldLabel="用户昵称" maxLength="32" name="UIUserName" allowBlank="false" tabIndex="65"/>
            <control-NumberField dataField="age" defaultValue="999" labelAlign="right" fieldName="userOrder" width="370" height="22" fieldLabel="年龄" name="UIUserOrder" allowBlank="false"/>
            <control-HiddenField dataField="branch_name" fieldName="branchName" name="branchNameField"/>
            <control-HiddenField dataField="org_id" fieldName="orgId" name="addOrgId"/>
            <control-TextField dataField="sex" labelAlign="right" fieldName="sex" width="370" height="22" fieldLabel="性别" name="sex" tabIndex="85"/>
          </layout-table>
        </control-FormPanel>
      </layout-fit>
      <Bottom>
        <control-ButtonGroup name="ButtonGroup1">
          <layout-buttonGroup>
            <control-Button name="Button9" text="确定" width="75" icon="bizframe/images/icons/accept.png" tabIndex="70"/>
            <control-Button name="Button7" text="重置" width="75" icon="bizframe/images/icons/refresh.png" tabIndex="71"/>
            <control-Button name="Button10" text="取消" width="75" icon="bizframe/images/icons/cross.gif" tabIndex="72"/>
          </layout-buttonGroup>
        </control-ButtonGroup>
      </Bottom>
    </control-Window>
  </Windows>
  <Accessory>
    <control-DataSet serviceAlias="customer.service.test.findPage" name="DataSet1" service="customer.service.test.findPage" usingServiceName="true" window="MainWin">
      <params>
        <param name="name"><![CDATA[]]></param>
        <param name="age"><![CDATA[]]></param>
        <param name="sex"><![CDATA[]]></param>
        <param name="nick"><![CDATA[]]></param>
      </params>
      <fields>
        <field name="userId" type="int"/>
        <field name="name" type="String"/>
        <field name="age" type="int"/>
        <field name="sex" type="String"/>
        <field name="nick" type="String"/>
      </fields>
    </control-DataSet>
    <control-DataSet name="DataSet3" service="customer.service.test.findObject" usingServiceName="true" window="Window2">
      <params>
        <param name="name"><![CDATA[]]></param>
        <param name="age"><![CDATA[]]></param>
        <param name="sex"><![CDATA[]]></param>
        <param name="nick"><![CDATA[]]></param>
      </params>
      <fields>
        <field name="userId" type="int"/>
        <field name="name" type="String"/>
        <field name="age" type="int"/>
        <field name="sex" type="String"/>
        <field name="nick" type="String"/>
      </fields>
    </control-DataSet>
  </Accessory>
  <WindowScripts>
    <WindowScript window="MainWin"><![CDATA[
//查询用户列表
event queryUser_btn_click(Button thisComp, Ext.EventObject e)
{

}

event addUser_btn_click(Button thisComp, Ext.EventObject e)
{
 
  var win = new Window1();
  win.show();
}

event editUser_btn_click(Button thisComp, Ext.EventObject e)
{
  var win = new Window2();
  var counts = Grid1.getSelectionModel().getSelections().length;
  if(counts!= 1)
  {
    Ext.Msg.alert('提示', '请选择一条用户记录');
    return;
  }
  win.show();
}





event Button22_click(Button thisComp, Ext.EventObject e)
{
  FormPanel1.getForm().reset();
}

]]></WindowScript>
    <WindowScript window="Window1"><![CDATA[remote bizframe.authority.user._userService as uService;

event Window1_complete() {
     if("true"==MainWin.extID_visible.toLowerCase()){
        UserJobNum.setVisible(true);
        UserJobNum.setEnabled(true);
        UserJobNum.setLabel(MainWin.extID_text);
        UserJobNum.fieldName=MainWin.extID_fieldName;
        
        // 读取配置文件的配置项，为UI属性项设值。
        UserJobNum.regex=top.userManageMw.uiExtUserID_validate;// 设置字段验证的正则表达式。
        UserJobNum.regexText=top.userManageMw.uiExtUserID_validateText;// 设置字段验证失败后的提示信息。
        
     }
     addOrgName.setValue(MainWin.tOrgName);
     addOrgName.defaultValue=MainWin.tOrgName;
     addOrgId.setValue(MainWin.tOrgId);
     addOrgId.defaultValue=MainWin.tOrgId;
     //searchDepCode.setEnabled(false);
}

event Button5_click(Button thisComp, Ext.EventObject e) {
	if(FormPanel2.getForm().isValid()){
		var authWin = new auth(MainWin).window;
		authWin.needAuth(authWin,'bizSetUser','bizUserAdd',MainWin, function(){
			var _values=FormPanel2.getValues();
			Ext.apply(_values,{resCode:"bizSetUser",opCode:"bizUserAdd"});
			Ext.apply(_values,{userStatus : UIUserStatus.getValue()});
			var response = uService.synExecute(_values);
			if(!(response.returnCode == 0)){
				Ext.Msg.alert('错误',response.errorInfo);
			}else{
				Ext.Msg.alert('提示','新增用户成功',
					function(){
						
						var _userId=UIUserId.getValue();
						var _orgName=addOrgName.getValue();
						var _orgId=addOrgId.getValue();
						var _uIUserStatus=UIUserStatus.getValue();
						
						MainWin.FormPanel1.getForm().reset();			
						//新增后查询该机构下所有的用户记录			
						//MainWin.TextField2.setValue(_userId);
						MainWin.searchOrgName.setValue(_orgName);
						MainWin.searchOrgId.setValue(_orgId);
						MainWin.DictComboBox1.setValue(_uIUserStatus);
						
						var _param=MainWin.FormPanel1.getValues();
						MainWin.DataSet1.setParams(_param);
						MainWin.Grid1.refresh();
						//var param = {};
						//Ext.apply(param,{userId:_userId});					
						//Ext.apply(param,{resCode:'bizSetUser'});
						//Ext.apply(param,{opCode:'bizSetUserFind'});
						//MainWin.DataSet1.clearParams();
						//MainWin.DataSet1.setParams(param);
						//MainWin.DataSet1.load();
						//FormPanel2.getForm().reset();
						close();		
					}
				);
			}
		});
	}
	else
		Ext.Msg.alert('错误',"发现有输入项不符合规范!");
}
event Button7_click(Button thisComp, Ext.EventObject e) {
	FormPanel2.getForm().reset();
	addOrgId.setValue(addOrgId.defaultValue);
}
event Button6_click(Button thisComp, Ext.EventObject e) {
	FormPanel2.getForm().reset();
	close();
}
event Button8_click(Button thisComp, Ext.EventObject e) {
	if(FormPanel2.getForm().isValid()){
		var authWin = new auth(MainWin).window;
		authWin.needAuth(authWin,'bizSetUser','bizUserAdd',MainWin, function(){
			var _values=FormPanel2.getValues();
			Ext.apply(_values,{resCode:"bizSetUser",opCode:"bizUserAdd"});
			Ext.apply(_values,{userStatus : UIUserStatus.getValue()});
			var response = uService.synExecute(_values);
			if(!(response.returnCode == 0)){
				Ext.Msg.alert('错误',response.errorInfo);
			}else{
				Ext.Msg.alert('提示','新增用户成功',
					function(){
						//MainWin.Grid1.refresh();
						var _userId=UIUserId.getValue();
						var _orgName=addOrgName.getValue();
						var _orgId=addOrgId.getValue();
						
						MainWin.FormPanel1.getForm().reset();						
						MainWin.TextField2.setValue(_userId);
						MainWin.searchOrgName.setValue(_orgName);
						MainWin.searchOrgId.setValue(_orgId);

						var _param=MainWin.FormPanel1.getValues();
						MainWin.DataSet1.setParams(_param);
						//MainWin.Grid1.refresh();
						//var param = {};
						//Ext.apply(param,{userId:_userId});					
						
						//Ext.apply(param,{resCode:'bizSetUser'});
						//Ext.apply(param,{opCode:'bizSetUserFind'});
						//MainWin.DataSet1.clearParams();
						
						//MainWin.DataSet1.setParams(param);
						MainWin.DataSet1.load();
						UIUserId.setValue('');
						UIUserName.setValue('');
						UIRemark.setValue('');
					}
				);
			}
		});
	}
	else
		Ext.Msg.alert('错误',"发现有输入项不符合规范!");
}

event searchDepCode_triggerclick(Hs.HsTargetSelect thisComp) {
	if(searchBranchCode.getValue()!=''){
		return true;
	}
	
	Ext.Msg.alert('提示','选择部门前请先选择一个机构')
	return false;
}

]]></WindowScript>
    <WindowScript window="Window2"><![CDATA[remote bizframe.authority.user._userService as uService;
event Button9_click(Button thisComp, Ext.EventObject e) {
	if(FormPanel3.getForm().isValid()){
	var authWin = new auth(MainWin).window;
		authWin.needAuth(authWin,'bizSetUser','bizUserModfiy',MainWin, function(){
			//var _values=FormPanel2.getValues();
			//Ext.apply(_values,{resCode:"bizSetUser",opCode:"bizUserModfiy"});
			//Ext.apply(_values,{userStatus : UIUserStatus.getValue(), lockStatus : UILockStatus.getValue()});
			var values=FormPanel3.getValues();
			Ext.apply(values,{resCode:"bizSetUser",opCode:"bizUserModfiy"});
			
			var response = uService.synExecute(values);
			if(!(response.returnCode == 0)){
				Ext.Msg.alert('错误',response.errorInfo);
			}else{
				Ext.Msg.alert('提示','修改用户成功',
					function(){
					
						//MainWin.Grid1.clear();
						MainWin.Grid1.refresh();
							
					 /*
					 var _param=	MainWin.DataSet1.getParams();
					 var _limit=MainWin.Grid1.getLimit();
				     var _start=MainWin.Grid1.getStart();
				     Ext.apply(_param,{start :_start});
				     Ext.apply(_param,{limit :_limit});
					 MainWin.DataSet1.load();
					 */
					 close();					
					}
				);
			}
		});
	
	/*
		
		var authWin = new auth(MainWin).window;
		authWin.needAuth(authWin,'bizSetUser','bizUserModfiy',MainWin, function(){
		var values=FormPanel3.getValues();
		Ext.apply(values,{resCode:"bizSetUser",opCode:"bizUserModfiy"});
		FormPanel3.commSubmit(values);
		
		});
		*/
	}
	else
		Ext.Msg.alert('错误',"发现有输入项不符合规范!");
}
event Button10_click(Button thisComp, Ext.EventObject e) {
	close();
}
event Window2_complete() {
	
    if("true"==MainWin.extID_visible.toLowerCase()){
        UserJobNum.setVisible(true);
        UserJobNum.setEnabled(true);
        UserJobNum.setLabel(MainWin.extID_text);
        UserJobNum.fieldName=MainWin.extID_fieldName;
        
        // 读取配置文件的配置项，为UI属性项设值。
        UserJobNum.regex=top.userManageMw.uiExtUserID_validate;// 设置字段验证的正则表达式。
        UserJobNum.regexText=top.userManageMw.uiExtUserID_validateText;// 设置字段验证失败后的提示信息。
    }
    var record = MainWin.Grid1.getSelectionModel().getSelected();
    UIUserId.setValue(record.get('user_id'));
	UIUserId.defaultValue=record.get('user_id');
	
	UserJobNum.setValue(record.get('ext_field_1'));
	UserJobNum.defaultValue=record.get('ext_field_1');
	
    UIUserName.setValue(record.get('user_name'));
	UIUserName.defaultValue=record.get('user_name');
	
	addOrgName.setValue(record.get('org_name'));
	addOrgName.defaultValue=record.get('org_name');
	
	addOrgId.setValue(record.get('org_id'));
	addOrgId.defaultValue=record.get('org_id');
	
	UIUserType.setValue(record.get('user_type'));
	UIUserType.defaultValue=record.get('user_type');
	
	UIUserStatus.setValue(record.get('user_status'));
	UIUserStatus.defaultValue=record.get('user_status');
	
	UIUserOrder.setValue(record.get('user_order'));
	UIUserOrder.defaultValue=record.get('user_order');
	
	/**
	UILockStatus.setValue(record.get('lock_status'));
	UILockStatus.defaultValue=record.get('lock_status');*/
	
	UIRemark.setValue(record.get('remark'));
	UIRemark.defaultValue=record.get('remark');
	
	/**20111111 huhl@hundsun.com  用用户昵称登陆   bengin**/
	if(top.BIZ_USER_LOGIN_NAME && "user_name"==top.BIZ_USER_LOGIN_NAME){
		UIUserName.setEditable(false);
	}
	/**20111111 huhl@hundsun.com  用用户昵称登陆   end **/
}

event Button7_click(Button thisComp, Ext.EventObject e) {
     FormPanel3.getForm().reset();
}
]]></WindowScript>
  </WindowScripts>
</hsdoc>
