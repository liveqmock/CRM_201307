<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" 
    "http://www.ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="SysCodeSQL">

    <typeAlias alias="customer" type="com.hundsun.crm.bean.CrmCustomer"/>

    <parameterMap id="forSaveParams" class="customer">
    	<parameter property="sysCodeId" jdbcType="INTEGER" javaType="java.lang.Long"/>
        <parameter property="codeType" jdbcType="VARCHAR" javaType="java.lang.String"/>
        <parameter property="code" jdbcType="VARCHAR" javaType="java.lang.String"/>
        <parameter property="codeName" jdbcType="VARCHAR" javaType="java.lang.String"/>
        <parameter property="sort" jdbcType="INTEGER" javaType="java.lang.Long"/>
        <parameter property="spell" jdbcType="VARCHAR" javaType="java.lang.String"/>
        <parameter property="isDeleted" jdbcType="VARCHAR" javaType="java.lang.String"/>
        <parameter property="canSelect" jdbcType="VARCHAR" javaType="java.lang.String"/>
        <parameter property="isStandard" jdbcType="VARCHAR" javaType="java.lang.String"/>
    </parameterMap>

    <resultMap id="sysCodeResult" class="sysCode">
        <result property="sysCodeId" column="ID"/>
        <result property="codeType" column="CODETYPE"/>
        <result property="code" column="CODE"/>
        <result property="codeName" column="CODENAME"/>
        <result property="sort" column="SORT"/>
        <result property="spell" column="PYT"/>
        <result property="isDeleted" column="DEL_FLAG"/>
        <result property="canSelect" column="CAN_SELECT"/>
        <result property="isStandard" column="ISSTANDARD"/>
    </resultMap>
	
	
	<select id="countUser" resultClass="java.lang.Long">    
        select count(*) as rowcount from sys_user  a
        where 1=1
           <isNotEmpty prepend="and" property="sysUser.loginId">
             a.LOGIN_ID like '%'||#sysUser.loginId#||'%'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="sysUser.userName">
             a.USER_NAME like '%'||#sysUser.userName#||'%'
          </isNotEmpty>          
    </select>
    
    <select id="findUserPage" resultMap="sysUserResult">
       select * from (
		select users.* ,ROWNUM as rn from (    
        select a.*,b.dept_name  as DEPT_NAME
        from sys_user a, sys_dept b
        where 
          a.dept_code = b.dept_code(+)
          <isNotEmpty prepend="and" property="sysUser.loginId">
             a.LOGIN_ID like '%'||#sysUser.loginId#||'%'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="sysUser.userName">
             a.USER_NAME like '%'||#sysUser.userName#||'%'
          </isNotEmpty>  
         order by a.id desc
        ) users
		    WHERE ROWNUM &lt;= #pageTo#
		) 
	   where rn &gt;= #pageFrom#		 
    </select>
	
    
</sqlMap>
